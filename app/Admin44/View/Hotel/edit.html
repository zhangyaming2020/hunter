<include file="Public:header" />
<!--编辑商品-->
<form id="info_form" action="{:u('hotel/edit')}" method="post" enctype="multipart/form-data">
<div class="pad_lr_10">
	<div class="col_tab">
		<ul class="J_tabs tab_but cu_li">
			<li class="current" id="currents">基本信息</li>
            <li id="currentss">展示图片</li>
			<!--<li>SEO设置</li>-->
            <li id="current">附加属性</li>
            <li id="current">添加房间</li>
		</ul>
		<div class="J_panes">
        <div class="content_list pad_10">
		<table width="100%" cellpadding="2" cellspacing="1" class="table_form">
			<tr>
				<th width="120">所属分类 :</th>
                <td><select class="J_item_cate_select mr10" id="aas" data-pid="0" data-uri="{:U('item_cate/ajax_getchilds', array('type'=>0))}" data-selected="{$selected_ids}"></select>
                <input type="hidden" name="cate_id" id="J_cate_id" value="{$info.cate_id}" /></td>
			</tr>
            <tr>
                <th width="120">城市/区域 :</th>
                <td>
                    <select class="J_cate_select mr10" data-pid="0" data-uri="{:U('place/ajax_getchilds')}" data-selected="{$place_selected_ids}"></select>
                    <input type="hidden" name="place_id" id="place_id" value="{$info.place_id}">
                </td>
            </tr>
            <tr>
                <th>酒店类型 :</th>
                <td>
                    <select name="attr_id" id="ass" >
                        <option >选择类型</option>
                        <volist name="attr" id="attr">
                            <option  <if condition="$info['attr_id'] eq $attr['id']">selected="selected"</if> value="{$attr['id']}">{$attr['name']}</option>
                        </volist>
                    </select>
                </td>
            </tr>
            <tr>
				<th>酒店名称 :</th>
				<td><input type="text" name="title" id="J_title" class="input-text" size="60" value="{$info.title}"></td>
			</tr>
            <tr>
                <th>酒店热线：</th>
                <td><input type="text" name="quota" size="20" class="input-text" value="{$info.quota}"></td>
            </tr>
            <tr>
				<th>酒店主图 :</th>
				<td>
					<notempty name="info['img']"><img src="{:attach($info['img'], 'item')}" width="100" height="100"/><br /></notempty>
					<!--<notempty name="info['img']"><img src="{:attach(get_thumb($info['img'], '_m'), 'item')}" width="100" height="100"/><br /></notempty>-->
					<input type="file" name="img" />
				</td>
 			</tr>
 			<!--<tr>
				<th>推荐图片 :</th>
				<td>
					<notempty name="info['recommend_img']"><img src="{:attach(get_thumb($info['recommend_img'], '_m'), 'item')}" width="100" height="100"/><br /></notempty>
					<input type="file" name="recommend_img" />
				</td>
 			</tr>-->
			<tr>
				<th>链接地址 :</th>
				<td><input type="text" name="url" class="input-text" size="50" value="{$info.url}"></td>
			</tr>
            <tr>

                <th>链接地址内容：</th>

                <td><textarea name="intro" cols="80" rows="5">{$info.intro}</textarea></td>

            </tr>
            <tr>
            <tr>
				<th>属性 :</th>
            <td><input type="checkbox" name="tj" value="1"  <?php if($tj==1){ ?>checked<?php } ?> /> 首页推荐&nbsp;&nbsp;&nbsp;
				</td>
			</tr>
            <tr>
                <th>设施 :</th>
                <td>
            <input type="checkbox" name="rm" value="1" <?php if($rm==1){ ?>checked<?php } ?>  /> wifi&nbsp;&nbsp;&nbsp;<input type="checkbox" name="xp" value="1" <?php if($xp==1){ ?>checked<?php } ?>  /> 停车场&nbsp;&nbsp;&nbsp;<input type="checkbox" name="yj" value="1" <?php if($yj==1){ ?>checked<?php } ?>  /> 会议室&nbsp;&nbsp;&nbsp;<input type="checkbox" name="ct" value="1"  <if condition="$info['ct'] eq 1">checked</if> /> 餐厅
            </td>
            </tr>
            <tr>
				<th>价格 :</th>
				<td><input type="text" name="price" size="10" class="input-text" value="{$info.price}"> 元</td>
			</tr>


            <tr>
                <th>最晚离店：</th>
                <td><input type="text" name="quote" size="20" class="input-text" value="{$info.quote}"></td>
            </tr>
            <tr>
                <th>最早离店：</th>
                <td><input type="text" name="origin" size="20" class="input-text" value="{$info.origin}"></td>
            </tr>
            <tr>
                <th>评分：</th>
                <td><input type="text" name="score" size="20" class="input-text" value="{$info.score}"></td>
            </tr>
            <tr>
                <th>星级：</th>
                <td><input type="text" name="star" size="20" class="input-text" value="{$info.star}"></td>
            </tr>
			<!--<tr>
            	<th>发布人 :</th>
                <td>{$info.uname}</td>
            </tr>-->
            <tr>
                <th>酒店介绍 :</th>
                <td><textarea name="info" class="info" style="width:80%;height:400px;visibility:hidden;resize:none;">{$info.info}</textarea></td>

            </tr>
            <tr>
                <th>酒店提示 :</th>
                <td><textarea name="hotel" class="hotel" style="width:80%;height:400px;visibility:hidden;resize:none;">{$info.hotel}</textarea></td>
            </tr>
            <tr>
                <th>周边交通 :</th>
                <td><textarea name="traffic" class="traffic" style="width:80%;height:400px;visibility:hidden;resize:none;">{$info.traffic}</textarea></td>

            </tr>
            <tr>
                <th>订单说明 :</th>
                <td><textarea name="seo_desc" class="seo_desc" style="width:80%;height:400px;visibility:hidden;resize:none;">{$info.seo_desc}</textarea></td>
            </tr>
            <tr>
                <th>地址：</th>
                <td><input type="text" name="unit" size="60" class="input-text" value="{$info.unit}"></td>
            </tr>
		</table>
		</div>
            <div class="content_list pad_10 hidden">
                <style>
                    .addpic {}
                    .addpic li { float:left; text-align:center; margin:0 0 10px 20px;}
                    .addpic a { display:block;}
                </style>
                <tr>
                    <select name="hotel_type" value ="1">
                        <option   value ="1">外景</option>
                        <option  value ="2">内景设施</option>
                        <option   value ="3">房间</option>
                        </volist>
                    </select>
                </tr>
                <ul class="addpic">
                    <a class="btn" id="logo_upload_btn" href="javascript:;"  style=" width: 80px; margin:10px 0;">上传商品副图</a>
                    <div id="logo_upload_area" style='width:80%'>
                        <div id='photos_area' class="photos_area clearfix">

                            <volist name="img_list" id="val">
                                <div class='item'>
                                    <input type='hidden' name='imgs[]' value="{$val['url']}"/>
                                    <img src="{:attach($val['url'],'item')}"  width='100px' height='100px'/>
                                    <div class='operate'><i class='toleft'>左移</i><i class='toright'>右移</i><i class='del'>删除</i></div>
                                </div>
                            </volist>
                        </div>
                </ul>
                <ul class="addpic">外景
                    <div id="logo_upload_area" style='width:80%'>
                        <div id='photos_area' class="photos_area clearfix">

                            <volist name="img_list1" id="val">
                                <div class='item'>

                                    <img src="{:attach($val['url'],'item')}"  width='100px' height='100px'/>
                                    <div class='operate'><i class='toleft'>左移</i><i class='toright'>右移</i><i class='del'>删除</i></div>
                                </div>
                            </volist>
                        </div>
                </ul>
                <ul class="addpic">内景设施
                    <div id="logo_upload_area" style='width:80%'>
                        <div id='photos_area' class="photos_area clearfix">

                            <volist name="img_list2" id="val">
                                <div class='item'>

                                    <img src="{:attach($val['url'],'item')}"  width='100px' height='100px'/>
                                    <div class='operate'><i class='toleft'>左移</i><i class='toright'>右移</i><i class='del'>删除</i></div>
                                </div>
                            </volist>
                        </div>
                </ul>
                <ul class="addpic">房间
                    <div id="logo_upload_area" style='width:80%'>
                        <div id='photos_area' class="photos_area clearfix">

                            <volist name="img_list3" id="val">
                                <div class='item'>

                                    <img src="{:attach($val['url'],'item')}"  width='100px' height='100px'/>
                                    <div class='operate'><i class='toleft'>左移</i><i class='toright'>右移</i><i class='del'>删除</i></div>
                                </div>
                            </volist>
                        </div>
                </ul>

                <div class="cb"></div>
                <table width="100%" cellpadding="2" cellspacing="1" class="table_form" id="first_upload_file">
                    <tbody class="uplode_file">
                    <!--<tr>
                        <th width="100" align="left"><a href="javascript:void(0);" class="blue" onclick="add_file();"><img src="__STATIC__/css/bgimg/tv-expandable.gif" /></a>上传文件 :</th>
                        <td><input type="file" name="imgs[]"></td>
                    </tr>-->
                    </tbody>
                </table>
            </div>
			
            <!--多属性设置-->
            <div class="content_list pad_10 hidden">
            <div class="table_list mb10">
            <table width="100%" border="0" cellspacing="0" cellpadding="0" id="J_cate_tree">
            <tbody>
            <tr>
            <th><input type="checkbox" name="checkall" class="J_checkall"></th>
            <th><span data-tdtype="order_by" data-field="id" class="sort_th">ID</span></th>
            <th>房型名称</th>
            <th>床铺类型</th>
            <th>市场价</th>
            <th>平台价</th>
            <th>房间图片</th>
            <th>赠送积分</th>
            <th>房间数</th>
            <th>备注 </th>
            <th>管理操作</th>
            </tr>
            <volist name="attr_list" id="xtx">
            <tr>
            <td align="center"><input type="checkbox" name="checkall" class="J_checkall"></td>
            <td align="center">{$xtx.id}</td>
            <td align="center" >{$xtx.attr_name}</td>
            <td align="center" >{$xtx.attr_value}</td>
            <td align="center" >
            ￥{$xtx.attr_price}
            </td>
            <td align="center" >
            ￥{$xtx.attr_oldprice}
            </td>
            <td align="center">
            <img src="{:attach($xtx['img'],'item')}" alt="" width="30" height="30" />
            </td>
            <td align="center" >
            {$xtx.attr_integral}分
            </td>
            <td align="center" >
            {$xtx.attr_num}间
            </td>
            <td align="center">
            {$xtx.attr_remark}
            </td>
            <td align="center" >
            <a href="{:U('hotel/bianji',array('id'=>$xtx['id']))}">编辑</a>|
            <a href="{:U('hotel/shanchu',array('id'=>$xtx['id']))}">删除</a>
            </td>
            </tr>
            </volist>
            </tbody>
            </table>
            </div>
            </div>
            
             <div class="content_list pad_10">
				
            <table class="table_form" cellpadding="0" cellspacing="0">
            <tbody>
            <tr>
            <th>*房型名称 :</th>
            <td>
            <input type="text" name="attr_name" class="input-text" size="10">
            </td>
            </tr>
            <tr>
            <th>*床铺类型 :</th>
            <td>
            <input type="text" name="attr_value" class="input-text" size="10">
            </td>
            </tr>
            <tr>
            <th>房间图片 :</th>
            <td>
            <input type="file" name="imgsss" >
            </td>
            </tr>
            <tr>
            <th>价格 :</th>
            <td>
            <input type="text" name="attr_price" class="input-text" size="10">  元
            </td>
            </tr>
            <tr>
            <th>原价 :</th>
            <td>
            <input type="text" name="attr_oldprice" class="input-text" size="10">  元
            </td>
            </tr>
            <tr>
            <th>房间设施 :</th>
            <td>
            <label for="wf"><input type="checkbox" id="wf" name="wf" value="1">免费WIFI</label>
            <label for="ch"><input type="checkbox" id="ch" name="ch" value="1">窗户</label>
            <label for="kt"><input type="checkbox" id="kt" name="kt" value="1">空调</label>
            <label for="dsj"><input type="checkbox" id="dsj" name="dsj" value="1">电视机</label>
            <label for="zc"><input type="checkbox" id="zc" name="zc" value="1">早餐</label>
            </td>
            </tr>
            <tr>
            <th>赠送积分 :</th>
            <td>
            <input type="text" name="attr_integral" class="input-text" size="10">  分
            </td>
            </tr>
            <tr>
            <th>房间数量 :</th>
            <td>
            <input type="text" name="attr_num" class="input-text" size="10">  间
            </td>
            </tr>
            <tr>
            <th>备注 :</th>
            <td>
            <textarea name="attr_remark" rows="" cols=""></textarea>
            </td>
            </tr>
            <tr>
            <th>预定须知 :</th>
            <td>
            <textarea name="attr_ydxz" rows="" cols=""></textarea>
            </td>
            </tr>
            <input type="hidden" name="item_id" value="{$info.id}" />
            </tbody>
            </table>
			  </div>
            </div>
            
            
        </div>
        <div class="mt10"><input type="submit" value="{:L('submit')}" id="dosubmit" name="dosubmit" class="btn btn_submit" style="margin:0 0 10px 100px;"></div>
    </div>
</div>
<input type="hidden" name="menuid"  value="{$menuid}"/>
<input type="hidden" name="id" value="{$info.id}" />
</form>

<script src="__PUBLIC_ADMIN__js/kindeditor/kindeditor-min.js"></script>
<script type="text/javascript" src="/theme/default/wap/plupload/plupload.full.min.js"></script>
<include file="Public:footer" />

<script>
    $('.J_item_cate_select').blur(function(){alert(21);
        var a= $('#J_cate_id').val();
        $.post('{:U("cates")}',{id:a},function(d){
            if(d.length>0){
                var ht='';
                for(var cc=0,cc;cc<d.length;cc++){
                    ht += '<option value="'+d[cc].id+'">'+d[cc].name+'</option>';
                }
                $('#ass').empty().append(ht);
            }
        })
    })

    $('#current').click(function(){
        $('#xtx').show();
    })
    $('#currents').click(function(){
        $('#xtx').hide();
    })
    $('#currentss').click(function(){
        $('#xtx').hide();
    })
</script>
<script type="text/javascript">
    $('.J_cate_select').cate_select({
        top_option: lang.all,
        field: 'place_id',
        target_class: 'J_cate_select'
    }); //区域分类联动
    $('.J_item_cate_select').cate_select({
        top_option: lang.all,
        field: 'J_cate_id',
        target_class: 'J_item_cate_select'
    });
$(function() {	
	KindEditor.create('.info', {
		uploadJson : '{:U("attachment/editer_upload")}',
		fileManagerJson : '{:U("attachment/editer_manager")}',
		allowFileManager : true
	});
	KindEditor.create('.seo_desc', {

		uploadJson : '{:U("attachment/editer_upload")}',

		fileManagerJson : '{:U("attachment/editer_manager")}',

		allowFileManager : true

	});
    KindEditor.create('.traffic', {

        uploadJson : '{:U("attachment/editer_upload")}',

        fileManagerJson : '{:U("attachment/editer_manager")}',

        allowFileManager : true

    });
    KindEditor.create('.hotel', {

        uploadJson : '{:U("attachment/editer_upload")}',

        fileManagerJson : '{:U("attachment/editer_manager")}',

        allowFileManager : true

    });
    var uploader = new plupload.Uploader({
        runtimes: 'gears,html5,html4,silverlight,flash',
        browse_button: 'logo_upload_btn',
        url: "{:U('item/ajax_upload_img')}",
        flash_swf_url: 'plupload/Moxie.swf',
        silverlight_xap_url: 'plupload/Moxie.xap',
        filters: {
            max_file_size: '25mb',
            mime_types: [
                {title: "files", extensions: "jpg,png,gif,jpeg"}
            ]
        },
        multi_selection: true,
        init: {
            FilesAdded: function(up, files) {
                $("#btn_submit").attr("disabled", "disabled").addClass("disabled").val("正在上传...");
                var item = '';
                plupload.each(files, function(file) { //遍历文件
                    item += "<div class='item' id='" + file['id'] + "'><div class='progress'><span class='bar'></span><span class='percent'>0%</span></div></div>";
                });
                $("#photos_area").append(item);
                uploader.start();
            },
            UploadProgress: function(up, file) { //上传中，显示进度条
                var percent = file.percent;
                $("#" + file.id).find('.bar').css({"width": percent + "%"});
                $("#" + file.id).find(".percent").text(percent + "%");
            },
            FileUploaded: function(up, file, info) {
                var data = eval("(" + info.response + ")");
                var datasrc=data.src;
                data.src='data/attachment/item/'+datasrc;

                $("#" + file.id).html("<input type=hidden name='imgs[]' value='" + datasrc + "'><img src='" + data.src + "' alt='" + data.name + "' width='100px' height='100px'>\n\
            <div class='operate'><i class='toleft'>左移</i><i class='toright'>右移</i><i class='del'>删除</i></div>")

                $("#btn_submit").removeAttr("disabled").removeClass("disabled").val("提 交");
                if (data.error != 0) {
                    alert(data.error);
                }
            },
            Error: function(up, err) {
                if (err.code == -601) {
                    alert("请上传jpg,png,gif,jpeg,zip或rar！");
                    $("#btn_submit").removeAttr("disabled").removeClass("disabled").val("提 交");
                }
            }
        }
    });
    uploader.init();
    //左右切换和删除图片
    $(function() {
        $(document).delegate(".toleft","click", function() {
            var item = $(this).parent().parent(".item");
            var item_left = item.prev(".item");
            if ($("#photos_area").children(".item").length >= 2) {
                if (item_left.length == 0) {
                    item.insertAfter($("#photos_area").children(".item:last"));
                } else {
                    item.insertBefore(item_left);
                }
            }

        })
        $(document).delegate(".toright","click", function() {
            var item = $(this).parent().parent(".item");
            var item_right = item.next(".item");
            if ($("#photos_area").children(".item").length >= 2) {
                if (item_right.length == 0) {
                    item.insertBefore($("#photos_area").children(".item:first"));
                } else {
                    item.insertAfter(item_right);
                }
            }
        })
        $(document).delegate(".del","click", function() {
            $(this).parent().parent(".item").remove();
        })
    })

	$('ul.J_tabs').tabs('div.J_panes > div');
	//自动获取标签
	$('#J_gettags').live('click', function() {
		var title = $.trim($('#J_title').val());
		if(title == ''){
			$.pinphp.tip({content:lang.article_title_isempty, icon:'alert'});
			return false;
		}
		$.getJSON('{:U("hotel/ajax_gettags")}', {title:title}, function(result){
			if(result.status == 1){
				$('#J_tags').val(result.data);
			}else{
				$.pinphp.tip({content:result.msg});
			}
		});
	});
	$.formValidator.initConfig({formid:"info_form",autotip:true});
	$("#J_title").formValidator({onshow:'请填写商品名称',onfocus:'请填写商品名称'}).inputValidator({min:1,onerror:'请填写商品名称'}).defaultPassed();
});
function get_child_cates(obj,to_id)
{
	var parent_id = $(obj).val();
	if( parent_id ){
		$.get('?m=hotel&a=get_child_cates&g=admin&parent_id='+parent_id,function(data){
				var obj = eval("("+data+")");
				$('#'+to_id).html( obj.content );
	    });
    }
}

function add_file()
{
    $("#next_upload_file .uplode_file").clone().insertAfter($("#first_upload_file .uplode_file:last"));
}
function del_file_box(obj)
{
	$(obj).parent().parent().remove();
}
function del_album(id)
{
	var url = "{:U('hotel/delete_album')}";
    $.get(url+"&album_id="+id, function(data){
		if(data==1){
		    $('.album_'+id).remove();
		};
    });
}
function add_attr()
{
    $("#hidden_attr .add_item_attr").clone().insertAfter($("#item_attr .add_item_attr:last"));
}
function del_attrs(obj)
{
	$(obj).parent().parent().remove();
}
function del_attr(id,obj)
{
	var url = "{:U('hotel/delete_attr')}";
    $.get(url+"&attr_id="+id, function(data){
		if(data==1){
		    $(obj).parent().parent().remove();
		};
    });
}
$('.shanchu').click(function(){
    var a=$(this).attr('data-id');
    $.post('{:U("shanchu")}',{id:a},function(d){
        if(d.status==1){
            alert('删除成功');
            window.location.href=window.location.href;
        }else{
            alert('删除失败');
        }
    })
})
</script>
<table id="next_upload_file" style="display:none;">
<tbody class="uplode_file">
   <tr>
      <th width="100"><a href="javascript:void(0);" onclick="del_file_box(this);" class="blue"><img src="__STATIC__/css/bgimg/tv-collapsable.gif" /></a>上传文件 :</th>
      <td><input type="file" name="imgs[]"></td>
   </tr>
</tbody>
</table>
<table id="hidden_attr" style="display:none;">
<!--<tbody class="add_item_attr">-->
<!--<tr>-->
    <!--<th width="200">-->
    <!--<a href="javascript:void(0);" class="blue" onclick="del_attrs(this);"><img src="__STATIC__/css/bgimg/tv-collapsable.gif" /></a>属性名 :<input type="text" name="attr[name][]" class="input-text" size="20">-->
    <!--</th>-->
    <!--<td>属性值 :<input type="text" name="attr[value][]" class="input-text" size="30"></td>-->
<!--</tr>-->
<!--</tbody>-->
</table>
</body>
</html>